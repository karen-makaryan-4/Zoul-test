<!DOCTYPE html>
<html>
  <head>
    <title>Redirecting...</title>
    <script type="text/javascript">
      function redirect() {
        const audioId = new URLSearchParams(window.location.search).get(
          'audioId'
        );

        if (!audioId) {
          return;
        }

        const appUrl = `zoul://?audioId=${audioId}`;
        const storeUrl = /iPhone|iPad|iPod/.test(navigator.userAgent)
          ? 'https://apps.apple.com/app/id6502774439'
          : 'https://play.google.com/store/apps/details?id=com.zoul.app';

        // Create an invisible iframe to try opening the app
        const iframe = document.createElement('iframe');
        iframe.style.display = 'none';
        iframe.src = appUrl;
        document.body.appendChild(iframe);

        // Check visibility change to determine if app was opened
        let visibilityChanged = false;
        document.addEventListener('visibilitychange', function () {
          if (document.visibilityState === 'visible') {
            visibilityChanged = true;
            window.location.href = storeUrl; // Redirect to app store if app isn't opened
          }
        });

        // Fallback if visibility does not change
        setTimeout(() => {
          if (!visibilityChanged) {
            window.location.href = storeUrl;
          }
        }, 1000); // Adjust timing as needed
      }

      document.addEventListener('DOMContentLoaded', redirect);
    </script>
  </head>
  <body>
    <p>
      If you are not redirected automatically,
      <a href="#" onclick="redirect()">click here</a>.
    </p>
  </body>
</html>
